<html>

<head>
    <title>Bot Buddy Blitz</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        /* background */
        canvas {
            background: #006400;
            display: block;
            margin: 0px auto;
            margin-top: 20px;
        }
    </style>

<body>



    <!-- playing field -->
    <canvas id="canvas" width="660" height="520"></canvas>
    <script>
        var canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        var op_score = 0;
        var player_score = 0;
        var x_min = 30;
        var x_max = 600;
        var y_min = 60;
        var y_max = 460;
        var ball_speed = 10;
        var xspeed_ball = 0;
        var yspeed_ball = 0;

        function draw_rect(x, y, w, h, b) {
            ctx.beginPath();
            if (b) {
                ctx.strokeStyle = "#111111";
                ctx.lineWidth = 40;
            } else {
                ctx.strokeStyle = "#ffffff";
                ctx.lineWidth = 4;
            }
            ctx.strokeRect(x, y, w, h);
            ctx.closePath();
        }

        function draw_goal(x, y, r, s) {
            ctx.beginPath();
            ctx.lineWidth = 4;
            if (s)
                ctx.arc(x, y, r, -Math.PI / 2, Math.PI / 2, false);
            else
                ctx.arc(x, y, r, Math.PI / 2, -Math.PI / 2, false);

            ctx.strokeStyle = "#ffffff";
            ctx.stroke();
            ctx.closePath();
        }

        function draw_circle(x, y, r, w) {
            ctx.beginPath();
            ctx.lineWidth = w;
            ctx.arc(x, y, r, 0, Math.PI * 2, false);
            ctx.strokeStyle = "#ffffff";
            ctx.stroke();
            ctx.closePath();
        }

        function draw_filled_circle(x, y, r, d) {
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
    
            if (d == 1) // user
            {
                ctx.fillStyle = "#50c878";
                ctx.strokeStyle = "#afe1af";
            } else if (d == 2) // teammate
            {
                ctx.fillStyle = "#0096ff";
                ctx.strokeStyle = "#89cff0";
            } else if (d == 3) // opponents
            {
                ctx.fillStyle = "#d2042d";
                ctx.strokeStyle = "#ee4b2b";
            } else // ball
            {
                ctx.fillStyle = "#ffffff";
                ctx.strokeStyle = "#000000";
            }
            ctx.fill();
            ctx.lineWidth = 3;

            ctx.stroke();
            ctx.closePath();
        }

        // create visual playing environment
        function draw_board() {
            draw_rect(0, 0, 660, 520, 1);
            draw_rect(30, 30, 600, 460, 0);
            draw_goal(30, 260, 70, 1);
            draw_goal(30, 260, 150, 1);
            draw_goal(630, 260, 70, 0);
            draw_goal(630, 260, 150, 0);
            draw_circle(330, 260, 40, 4);
            draw_circle(330, 260, 5, 4);

            // center line
            ctx.beginPath();
            ctx.moveTo(330, 30);
            ctx.lineTo(330, 490);
            ctx.stroke();
            ctx.closePath();

            // home goal
            ctx.beginPath();
            ctx.moveTo(30, 190);
            ctx.lineTo(30, 330);
            ctx.lineWidth = 4;
            ctx.strokeStyle = "#ffff00";
            ctx.stroke();
            ctx.closePath();

            // away goal
            ctx.beginPath();
            ctx.moveTo(630, 190);
            ctx.lineTo(630, 330);
            ctx.stroke();
            ctx.closePath();

            // scores
            ctx.font = "50px Pristina";
            ctx.lineWidth = 2
            ctx.strokeText(op_score, 370, 100);
            ctx.strokeText(player_score, 270, 100);
        }
        draw_board();
        

        // mallet class
        var mallet = function(x, y, r) {
            this.x = x;
            this.y = y;
            this.radius = r;
        }
        // create mallets
        var player = new mallet(530, 360, 20); 
        var teammate = new mallet(530, 160, 20);
        var opponent1 = new mallet(130, 360, 20);
        var opponent2 = new mallet(130, 160, 20);

        // ball class
        var ball = function(x, y, r) {
            this.x = x;
            this.y = y;
            this.radius = r;
        }
        // create ball 
        var ball = new ball(canvas.width / 2, canvas.height / 2, 10);

        function mouseMoveHandler(e) {
            var relativeX = e.clientX - canvas.offsetLeft;
            var relativeY = e.clientY - canvas.offsetTop;

            if (relativeX > 60 && relativeX < canvas.width - 60) {
                player.x = relativeX;
            }
            //360
            if (relativeY > 0 && relativeY < 600) {
                player.y = relativeY;
            }
        }

        document.addEventListener("mousemove", mouseMoveHandler, false);

        function play() {

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            draw_board();
            draw_filled_circle(player.x, player.y, player.radius, 1);
            draw_filled_circle(teammate.x, teammate.y, teammate.radius, 2)
            draw_filled_circle(opponent1.x, opponent1.y, opponent1.radius, 3);
            draw_filled_circle(opponent2.x, opponent2.y, opponent2.radius, 3);
            draw_filled_circle(ball.x, ball.y, ball.radius, 0);

            // have ball bounce off left-right walls
            if (ball.x > canvas.width - 45 || ball.x + xspeed_ball < 45) {
                xspeed_ball *= -1;
            }

             
            // have ball bounce off top-bottom walls
            else {
                if (ball.y + yspeed_ball > canvas.height - 45 || ball.y + yspeed_ball < 45) {
                    yspeed_ball *= -1;
                }
            }

            // goal logic
            if (ball.y > 190 && ball.y < 330) {
                if (ball.x > canvas.width - 45) { // opponents scores
                     ball.x = canvas.width / 2 + 100;
                    ball.y = canvas.height / 2;
                    xspeed_ball = 0;
                    yspeed_ball = 0;
                    op_score = op_score + 1;
                } else if (ball.x < 50) { // player scores
                    ball.x = canvas.width / 2 - 100;
                    ball.y = canvas.height / 2;
                    xspeed_ball = 0;
                    yspeed_ball = 0;
                    player_score = player_score + 1;
                }
            }
            
            // player bounds
            if (player.x < x_min + 30) {
                player.x = x_min + 30;
            }
            if (player.x > x_max) {
                player.x = x_max;
            }
            if (player.y < y_min) {
                player.y = y_min;
            }
            if (player.y > y_max) {
                player.y = y_max;
            }

            // ball bounds
            if (ball.x <= x_min - 30 || ball.x >= x_max + 30 || ball.y <= y_min -30 || ball.y >= y_max + 30) {
                ball.x = canvas.width/2;
                ball.y = canvas.height/2;
                xspeed_ball = 0;
                yspeed_ball = 0;
            }

            function mallet_ball_interaction(mallet){
                // player-ball interaction
                function distance(x1, y1, x2, y2) {
                    var tempx = x2 - x1;
                    var tempy = y2 - y1;
                    tempx *= tempx;
                    tempy *= tempy;
                    return Math.sqrt(tempx + tempy);
                }

                dist = distance(mallet.x, mallet.y, ball.x, ball.y);
                if (dist < 30) {
                    var dx = ball.x - mallet.x;
                    var dy = ball.y - mallet.y;
                    dx /= 60;
                    dy /= 60;
                    xspeed_ball = dx * ball_speed;
                    yspeed_ball = dy * ball_speed;
                }
            }

            // player-ball interaction
            mallet_ball_interaction(player);

            // ball physics
            ball.x += xspeed_ball;
            ball.y += yspeed_ball;

            xspeed_ball *= 0.995;
            yspeed_ball *= 0.995;
            }
            

        setInterval(play, 1/1000);
    </script>
</body>
</head>

</html>
